const REEL_WIDTH=100,REEL_HEIGHT=100,REELS_COUNT=5,ROWS_COUNT=3,SPRITE_SIZE=150,BUTTON_SIZE=140,SYMBOLS=["hv1","hv2","hv3","hv4","lv1","lv2","lv3","lv4"],REEL_BANDS=[["hv2","lv3","lv3","hv1","hv1","lv1","hv1","hv4","lv1","hv3","hv2","hv3","lv4","hv4","lv1","hv2","lv4","lv1","lv3","hv2"],["hv1","lv2","lv3","lv2","lv1","lv1","lv4","lv1","lv1","hv4","lv3","hv2","lv1","lv3","hv1","lv1","lv2","lv4","lv3","lv2"],["lv1","hv2","lv3","lv4","hv3","hv2","lv2","hv2","hv2","lv1","hv3","lv1","hv1","lv2","hv3","hv2","hv4","hv1","lv2","lv4"],["hv2","lv2","hv3","lv2","lv4","lv4","hv3","lv2","lv4","hv1","lv1","hv1","lv2","hv3","lv2","lv3","hv2","lv1","hv3","lv2"],["lv3","lv4","hv2","hv3","hv4","hv1","hv3","hv2","hv2","hv4","hv4","hv2","lv2","hv4","hv1","lv2","hv1","lv2","hv4","lv4"]],PAYTABLE={hv1:[10,20,50],hv2:[5,10,20],hv3:[5,10,15],hv4:[5,10,15],lv1:[2,5,10],lv2:[1,2,5],lv3:[1,2,3],lv4:[1,2,3]},PAYLINES=[[0,0,0,0,0],[1,1,1,1,1],[2,2,2,2,2],[1,1,2,2,2],[2,2,1,1,1],[1,2,1,2,1],[2,1,2,1,2]],ASSETS={symbols:{hv1:"assets/hv1_symbol.png",hv2:"assets/hv2_symbol.png",hv3:"assets/hv3_symbol.png",hv4:"assets/hv4_symbol.png",lv1:"assets/lv1_symbol.png",lv2:"assets/lv2_symbol.png",lv3:"assets/lv3_symbol.png",lv4:"assets/lv4_symbol.png"},spinButton:"assets/spin_button.png"};let app=new PIXI.Application({resizeTo:window,backgroundColor:1087931,resolution:window.devicePixelRatio||1,autoDensity:!0});document.getElementById("game-container").appendChild(app.view);const loader=new PIXI.Loader;Object.values(ASSETS.symbols).forEach((e=>loader.add(e))),loader.add(ASSETS.spinButton);const loaderBackground=new PIXI.Graphics;loaderBackground.beginFill(1710618),loaderBackground.drawRect(0,0,app.screen.width,app.screen.height),loaderBackground.endFill(),app.stage.addChild(loaderBackground);const loaderText=new PIXI.Text("Loading: 0%",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"center"});loaderText.anchor.set(.5),loaderText.x=app.screen.width/2,loaderText.y=app.screen.height/2,app.stage.addChild(loaderText);let progress=0;const totalAssets=Object.keys(ASSETS.symbols).length+1,fakeProgressInterval=300,progressStep=100/totalAssets;let gameContainer,reelsContainer,symbolsSprites,backgroundSprites,spinButton,winningsText;loader.onProgress.add((e=>{progress=Math.min(progress+progressStep,e.progress),loaderText.text="Loading: 0%",loaderText.x=app.screen.width/2,loaderText.y=app.screen.height/2})),loader.load((()=>{let e=0;const n=()=>{e<totalAssets?(progress=(e+1)*progressStep,loaderText.text=`Loading: ${Math.round(progress)}%`,loaderText.x=app.screen.width/2,loaderText.y=app.screen.height/2,e++,setTimeout(n,300)):(app.stage.removeChild(loaderText),setupGame())};setTimeout(n,300)}));let currentPositions=[0,0,0,0,0];function setupGame(){const e=new PIXI.Graphics;e.beginFill(1087931),e.drawRect(0,0,app.screen.width,app.screen.height),e.endFill(),app.stage.addChild(e),app.stage.removeChild(loaderText),gameContainer=new PIXI.Container,app.stage.addChild(gameContainer),reelsContainer=new PIXI.Container,gameContainer.addChild(reelsContainer),symbolsSprites=[],backgroundSprites=[];for(let e=0;e<ROWS_COUNT;e++){symbolsSprites[e]=[],backgroundSprites[e]=[];for(let n=0;n<REELS_COUNT;n++){const t=new PIXI.Graphics;t.beginFill(0,0),t.drawRect(-SPRITE_SIZE/2,-SPRITE_SIZE/2,SPRITE_SIZE,SPRITE_SIZE),t.endFill(),reelsContainer.addChild(t),backgroundSprites[e][n]=t;const s=getSymbolAt(n,e,currentPositions[n]),l=loader.resources[ASSETS.symbols[s]].texture,o=new PIXI.Sprite(l);o.anchor.set(.5),reelsContainer.addChild(o),symbolsSprites[e][n]=o}}spinButton=new PIXI.Sprite(loader.resources[ASSETS.spinButton].texture),spinButton.anchor.set(.5),spinButton.interactive=!0,spinButton.buttonMode=!0,spinButton.on("pointerdown",onSpin),gameContainer.addChild(spinButton),winningsText=new PIXI.Text("",{fontFamily:"Arial",fontSize:32,fill:16776960,align:"center",wordWrap:!0,wordWrapWidth:600}),winningsText.anchor.set(.5,0),gameContainer.addChild(winningsText),updateReels(),displayWinnings([]),gameContainer.x=app.screen.width/2,gameContainer.y=app.screen.height/2,window.addEventListener("resize",resizeGame),resizeGame()}function getSymbolAt(e,n,t){const s=REEL_BANDS[e];return s[(t+n)%s.length]}function onSpin(){currentPositions=REEL_BANDS.map((e=>Math.floor(Math.random()*e.length))),updateReels();const e=[];for(let n=0;n<ROWS_COUNT;n++){e[n]=[];for(let t=0;t<REELS_COUNT;t++)e[n][t]=getSymbolAt(t,n,currentPositions[t])}displayWinnings(calculateWinnings(e))}function displayWinnings({total:e=0,results:n=[]}){let t=`Total wins: ${e}`;n.length&&n.forEach((e=>{t+=`\n- Payline ${e.payline}, ${e.symbol} x${e.count}, ${e.payout}`})),winningsText.text=t,scaleWinningsText();for(let e=0;e<ROWS_COUNT;e++)for(let n=0;n<REELS_COUNT;n++)backgroundSprites[e][n].clear(),backgroundSprites[e][n].beginFill(0,0),backgroundSprites[e][n].drawRect(-SPRITE_SIZE/2,-SPRITE_SIZE/2,SPRITE_SIZE,SPRITE_SIZE),backgroundSprites[e][n].endFill();n.forEach((e=>{const n=PAYLINES[e.payline-1];for(let t=0;t<e.count;t++){const e=n[t],s=t;backgroundSprites[e][s].clear(),backgroundSprites[e][s].beginFill(16776960,1),backgroundSprites[e][s].drawRect(-SPRITE_SIZE/2,-SPRITE_SIZE/2,SPRITE_SIZE,SPRITE_SIZE),backgroundSprites[e][s].endFill()}}))}function updateReels(){for(let e=0;e<ROWS_COUNT;e++)for(let n=0;n<REELS_COUNT;n++){const t=getSymbolAt(n,e,currentPositions[n]),s=loader.resources[ASSETS.symbols[t]].texture;symbolsSprites[e][n].texture=s}}function calculateWinnings(e){const n=[];let t=0;return PAYLINES.forEach(((s,l)=>{const o=s.map(((n,t)=>e[n][t])),i=o[0];let r=1;for(let e=1;e<o.length&&o[e]===i;e++)r++;if(r>=3){const e=PAYTABLE[i][r-3];t+=e,n.push({payline:l+1,symbol:i,count:r,payout:e})}})),{total:t,results:n}}function resizeGame(){const e=window.innerWidth,n=window.innerHeight,t=REELS_COUNT*SPRITE_SIZE+20*(REELS_COUNT-1),s=ROWS_COUNT*SPRITE_SIZE+20*(ROWS_COUNT-1),l=s+BUTTON_SIZE+40+200,o=Math.min(.9*e/t,.9*n/l,1);gameContainer.scale.set(o),gameContainer.x=e/2-t*o/2,gameContainer.y=n/2-l*o/2,reelsContainer.x=0,reelsContainer.y=0;for(let e=0;e<ROWS_COUNT;e++)for(let n=0;n<REELS_COUNT;n++){const t=symbolsSprites[e][n],s=backgroundSprites[e][n];t.x=n*(SPRITE_SIZE+20)+SPRITE_SIZE/2,t.y=e*(SPRITE_SIZE+20)+SPRITE_SIZE/2,t.width=SPRITE_SIZE,t.height=SPRITE_SIZE,s.x=t.x,s.y=t.y}spinButton.x=t/2,spinButton.y=s+BUTTON_SIZE/2+40,spinButton.width=BUTTON_SIZE,spinButton.height=BUTTON_SIZE,winningsText.x=t/2,winningsText.y=s+BUTTON_SIZE+60,scaleWinningsText()}function centerDisplayObject(e){e.x=app.screen.width/2,e.y=app.screen.height/2}function scaleWinningsText(){if(!winningsText)return;const e=REELS_COUNT*SPRITE_SIZE+20*(REELS_COUNT-1);winningsText.style.wordWrapWidth=e,winningsText.scale.set(1),winningsText.height>180&&winningsText.scale.set(180/winningsText.height)}